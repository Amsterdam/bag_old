database:
  image: build.datapunt.amsterdam.nl:5000/atlas/postgres
  ports:
    - "5434:5432"
  environment:
    POSTGRES_PASSWORD: insecure
    POSTGRES_USER: atlas
    POSTGRES_DB: atlas
    LOCAL: "True"
  volumes:
      - "~/.ssh/datapunt.key:/root/.ssh/datapunt.key"

elasticsearch:
  image: build.datapunt.amsterdam.nl:5000/atlas/elasticsearch5:latest
  command: elasticsearch -Ehttp.host=0.0.0.0 -Etransport.host=127.0.0.1

  ports:
    - "9200:9200"
    - "9300:9300"

atlas:
  build: .
  links:
    - database:database
    - elasticsearch:elasticsearch
  ports:
    - "8080:8080"
  environment:
    DATABASE_NAME: atlas
    DATABASE_PASSWORD: insecure
    BAG_OBJECTSTORE_PASSWORD: insecure
    JWT_SHARED_SECRET_KEY: atleast16characters
    UWSGI_HTTP: ":8080"
    UWSGI_MODULE: "bag.wsgi:application"
    UWSGI_PROCESSES: 4
    UWSGI_MASTER: 1
    UWSGI_STATIC_MAP: "/static=/static"
    UWSGI_VACUUM: 1
    UWSGI_HARAKIRI: 15
    UWSGI_DIE_ON_TERM: 1
